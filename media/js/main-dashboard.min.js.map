{"version":3,"file":"main-dashboard.min.js","names":["_petiteVueMin","require","_typeof","a","Symbol","iterator","constructor","prototype","SitesList","props","b","c","d","e","f","g","options","akeeba","System","getOptions","$template","sites","MAX_TIMER","maxTimer","MAX_PAGES","maxPages","PAGE_LENGTH","pageLimit","restartTimer","availableTime","countdownTimer","error","feedMeData","counter","axios","get","concat","url","then","response","data","length","catch","stopTimer","resetTimer","toggleTimer","window","clearInterval","setInterval","timerTick","mounted","reload","createApp","mount"],"sources":["main-dashboard.js"],"sourcesContent":["/*\n * @package   panopticon\n * @copyright Copyright (c)2023-2023 Nicholas K. Dionysopoulos / Akeeba Ltd\n * @license   https://www.gnu.org/licenses/agpl-3.0.txt GNU Affero General Public License, version 3 or later\n */\n\nimport {createApp} from \"../petite-vue/petite-vue.min.js\";\n\nfunction SitesList(props)\n{\n    const options = akeeba.System.getOptions(\"panopticon.dashboard\");\n\n    return {\n        $template:      \"#sitesListTemplate\",\n        sites:          [],\n        MAX_TIMER:      props?.maxTimer ?? (options?.maxTimer ?? 90),\n        MAX_PAGES:      props?.maxPages ?? (options?.maxPages ?? 50),\n        PAGE_LENGTH:    props?.pageLimit ?? (options?.pageLimit ?? 20),\n        restartTimer:   false,\n        availableTime:  0,\n        countdownTimer: null,\n        error:          null, // The method feeding data to the view\n        feedMeData(counter)\n        {\n            // Initialise the display on the very first execution\n            if (counter === 0)\n            {\n                this.sites = [];\n            }\n\n            // I will only display up to MAX_PAGES pages at once\n            if (counter >= this.MAX_PAGES)\n            {\n                return;\n            }\n\n            axios\n                .get(`${options.url}&limitstart=${this.PAGE_LENGTH * counter}&limit=${this.PAGE_LENGTH}`)\n                .then((response) =>\n                {\n                    this.error = null;\n\n                    // If we ran out of data, return false to prevent the next handler from fetching more data.\n                    if (typeof response.data !== \"object\" || response.data.length === 0)\n                    {\n                        return false;\n                    }\n\n                    // Append the retrieved data to the internal list.\n                    this.sites = this.sites.concat(response.data)\n\n                    // Get me some more data to display!\n                    this.feedMeData(++counter)\n                })\n                .catch((error) =>\n                {\n                    this.stopTimer()\n                    this.error = error\n                })\n\n            if (!this.countdownTimer && this.restartTimer)\n            {\n                this.restartTimer = false\n                this.resetTimer()\n                this.toggleTimer()\n            }\n        },\n        resetTimer()\n        {\n            this.availableTime = this.MAX_TIMER;\n        },\n        toggleTimer()\n        {\n            if (this.countdownTimer)\n            {\n                window.clearInterval(this.countdownTimer);\n                this.availableTime = this.MAX_TIMER\n\n                this.countdownTimer = null;\n\n                return;\n            }\n\n            this.countdownTimer = window.setInterval(this.timerTick, 1000);\n        },\n        stopTimer()\n        {\n            if (this.countdownTimer)\n            {\n                this.toggleTimer();\n            }\n        },\n        timerTick()\n        {\n            this.availableTime -= 1;\n\n            if (this.availableTime === 0)\n            {\n                this.toggleTimer()\n                this.restartTimer = true\n                this.feedMeData(0)\n            }\n        }, // This runs when the component initialises\n        mounted()\n        {\n            this.availableTime = this.MAX_TIMER\n            this.toggleTimer()\n            this.feedMeData(0)\n        },\n        reload()\n        {\n            this.restartTimer = this.countdownTimer !== null\n\n            if (this.restartTimer)\n            {\n                this.toggleTimer()\n            }\n\n            this.feedMeData(0)\n        }\n    }\n}\n\ncreateApp({SitesList}).mount()"],"mappings":"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"}